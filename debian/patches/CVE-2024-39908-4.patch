From: Watson <watson1978@gmail.com>
Date: Tue, 16 Jul 2024 11:04:40 +0900
Subject: [PATCH] Fix performance issue caused by using repeated `>`
 characters  inside `CDATA [ PAYLOAD ]` (#172)

A `<` is treated as a string delimiter.
In certain cases, if `<` is used in succession, read and match are
repeated, which slows down the process. Therefore, the following is used
to read ahead to a specific part of the string in advance.

Origin: https://github.com/ruby/rexml/commit/9f1415a2616c77cad44a176eee90e8457b4774b6
Bug: https://www.ruby-lang.org/en/news/2024/07/16/dos-rexml-cve-2024-39908/
Bug-github: https://github.com/advisories/GHSA-4xqq-m2hx-25v8
---
 test/parse/test_cdata.rb | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 test/parse/test_cdata.rb

diff --git a/test/parse/test_cdata.rb b/test/parse/test_cdata.rb
new file mode 100644
index 0000000..9e8fa8b
--- /dev/null
+++ b/test/parse/test_cdata.rb
@@ -0,0 +1,17 @@
+require "test/unit"
+require "core_assertions"
+
+require "rexml/document"
+
+module REXMLTests
+  class TestParseCData < Test::Unit::TestCase
+    include Test::Unit::CoreAssertions
+
+    def test_gt_linear_performance
+      seq = [10000, 50000, 100000, 150000, 200000]
+      assert_linear_performance(seq, rehearsal: 10) do |n|
+        REXML::Document.new('<description><![CDATA[ ' + ">" * n + ' ]]></description>')
+      end
+    end
+  end
+end
