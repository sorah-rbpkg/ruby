Origin: https://github.com/ruby/ruby/commit/14510521720231dd9f07d949c86c9df9c52b205b
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2024-08-03

From 14510521720231dd9f07d949c86c9df9c52b205b Mon Sep 17 00:00:00 2001
From: Hiroshi SHIBATA <hsbt@ruby-lang.org>
Date: Tue, 23 Apr 2024 19:23:09 +0900
Subject: merge revision(s) 989a2355808a63fc45367785c82ffd46d18c900a:

	Fix Use-After-Free issue for Regexp

	Co-authored-by: Isaac Peka <7493006+isaac-peka@users.noreply.github.com>
	---
	 regexec.c | 2 +-
	 1 file changed, 1 insertion(+), 1 deletion(-)
---
 regexec.c | 2 +-
 version.h | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

Index: ruby/regexec.c
===================================================================
--- ruby.orig/regexec.c
+++ ruby/regexec.c
@@ -2526,8 +2526,8 @@ match_at(regex_t* reg, const UChar* str,
     CASE(OP_MEMORY_END_PUSH_REC)  MOP_IN(OP_MEMORY_END_PUSH_REC);
       GET_MEMNUM_INC(mem, p);
       STACK_GET_MEM_START(mem, stkp); /* should be before push mem-end. */
-      STACK_PUSH_MEM_END(mem, s);
       mem_start_stk[mem] = GET_STACK_INDEX(stkp);
+      STACK_PUSH_MEM_END(mem, s);
       MOP_OUT;
       JUMP;
 
